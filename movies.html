<!DOCTYPE html>
<html lang="en">
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Elijah Soria's Complete Movie Ratings.">
<title>Elijah Soria -- Movie Ratings</title>
<link rel="icon" type="image/png" href="grateful-dead-logo.png">
<link rel="stylesheet" href="site_common.css">
<script type="application/ld+json">
{
  "@context": "https://schema.org/",
  "@type": "WebSite",
  "name": "Elijah Soria -- Movie Ratings",
  "url": "https://elijahsoria.github.io/movies.html"
}
</script>
<style>
#header{
	padding:10px
}
.table-container {
   width: 540px;
}
.sort-select {
   font-size: 16px;
   padding: 2px;
   border-radius: 10px;
}
.elijahimage {
  height: auto;
  width: 200px;
}
.menu {
  text-align: center;
  padding: 20px 0;
}
.r {
   display: flex;
   width: 100%;
   justify-content: space-between;
   align-items: center;
}
.c {
  padding: 15px 10px;
  text-align: left;
}
@media (max-width: 635px) {
  .table-container {
   width: 85vw;
  }
}
</style>
</head>
<body>
<div id="header"></div>
<center>
<div class="table-container">
   <div class="r menu">
	<a href="./index.html">Home</a>
	<a href="https://www.linkedin.com/in/elijah-soria-a63859a4/">LinkedIn</a>
        <a href="https://github.com/elijahsoria">Github</a>
        <a href="ElijahSoriaResume.pdf">Resume</a>
   </div>
   <h2>Elijah's Movie Reviews<br/>⭐⭐⭐⭐⭐</h2>
   Sort by: <select class="sort-select" id="sort_by">
    <option value="recently_watched" selected>Recently Watched</option>
    <option value="title">Movie Title (A->Z)</option>
    <option value="high_rated">Highest Rated</option>
    <option value="low_rated">Lowest Rated</option>
   </select>
   <div id="movie-list"></div>
	<script>
let mvlist = [];
let mvlist_recently_watched = [];

function updateMovieEl(mvs) {
	let listdiv = document.getElementById('movie-list');
	listdiv.innerHTML = "";
	for (let i = 0; i < mvs.length; i++) {
			let mv = mvs[i];
			let mvDiv = document.createElement("div");
			mvDiv.classList.add("r");
			let name = document.createElement("div");
			name.innerHTML = mv[0];
			name.classList.add("c");
			let rtg = document.createElement("div"); 
			rtg.innerHTML = mv[1];
			rtg.classList.add("c");
			mvDiv.appendChild(name);
			mvDiv.appendChild(rtg);
			listdiv.appendChild(mvDiv);
    		}
};

function createMovieList() {
    fetch("./movies.txt")
   	.then( r => r.text() )
   	.then( text => {
    		let mvs = text.split("\n");
    		for (let i = mvs.length - 2; i >= 0; i--) {
			let mv = mvs[i].split(";");
			if (mv[0] && mv[1]) {
				mvlist.push([mv[0], mv[1]]);
			}
    		}
	        mvlist_recently_watched = [...mvlist];
	        updateMovieEl(mvlist);
    	});
};
createMovieList();
		
function stringSortFn(a,b) {
	if (a < b) {
			    return -1;
		    }
		    if (a > b) {
			    return 1;
		    } else {
			    return 0;
		    }
};

function sortMovies(event) {
  console.log("updating...");
  let menu = document.getElementById("sort_by");
  if (menu.value == 'title') {
    updateMovieEl(mvlist.sort((a,b) => stringSortFn(a[0], b[0])));
  } else if (menu.value == 'high_rated') {
    updateMovieEl(mvlist.sort((a,b) => {
	    if (a[1] == b[1]) {
		    return stringSortFn(a[0], b[0]);
	    } else {
		    return parseFloat(b[1]) - parseFloat(a[1]);
	    }
    }));
  } else if (menu.value == 'low_rated') {
    updateMovieEl(mvlist.sort((a,b) => {
	    if (a[1] == b[1]) {
		    return stringSortFn(a[0], b[0]);
	    } else {
		    return parseFloat(a[1]) - parseFloat(b[1]);
	    }
    }));
  } else if (menu.value == 'recently_watched') {
    updateMovieEl(mvlist_recently_watched);
  } 
};
let menu = document.getElementById("sort_by");
menu.addEventListener("change", sortMovies);
</script>
</div>
</center>
</body>
</html>
